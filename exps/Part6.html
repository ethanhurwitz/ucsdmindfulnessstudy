<!DOCTYPE html>
<html>
<head>
<title>UCSD Study Part 6</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script> -->
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://timbrady.org/turk/TimTurkTools.js"></script> -->
<script src="../jsLibs/jquery-3-6-0-min.js"></script>
<script src="../jsLibs/ajax.js"></script>
<script src="../jsLibs/bootstrap-min.js"></script>
<script src="../jsLibs/TimTurkTools.js"></script>
<script src="../jsPsych/jspsych-6.1.0/jspsych.js"></script>
<script src="../jsPsych/jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
<script src="../jsPsych/jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
<script src="../jsPsych/jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
<script src="../jsPsych/jspsych-6.1.0/plugins/jspsych-survey-multi-choice.js"></script>
<script src="../jsPsych/jspsych-6.1.0/plugins/jspsych-survey-multi-select.js"></script>
<script src="../jsPsych/jspsych-6.1.0/plugins/jspsych-video-button-response.js"></script>
<script src="../jsPsych/jspsych-6.1.0/plugins/jspsych-survey-text.js"></script>
<!-- <script src="../jsPsych/jspsych-6.1.0/plugins/jspsych-free-sort_update2.js"></script> -->
<script src="../jsPsych/jspsych-6.1.0/plugins/jspsych-free-sort-NEW_updated2.js"></script>
<script src="../jsPsych/jspsych-6.1.0/plugins/jspsych-survey-html-form.js"></script>
<!--audio record 1-->
<script src="../jsPsych/jspsych-6.1.0/plugins/jspsych-html-audio-response_modified.js"></script>
<!--audio record 2-->
<script src="../jsPsych/jspsych-6.1.0/plugins/jspsych-html-audio-response.js"></script>
<!--link here-->
<link href="../jsPsych/jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>

<style>
    .CDmask {
        height: 550px;
        width: 550px;
    }
    .CDimage {
        height: 500px;
        width: 500px;
    }

</style>
</head>
  
  <body>
    <script>

// var randCode = "COG" + Math.round(Math.random()*1000) + "420" + Math.round(Math.random()*1000) + "FLEX";

Shuffle = function (o) {
    for (var j, x, i = o.length; i; j = parseInt(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
    return o;
};

var startTime = new Date();

var timeline = [];

var partID = {
  type: 'survey-text',
  questions: [
    {prompt: "Enter ID", name: 'partID', rows: 1, columns: 12, required: true}
  ],
  data: {
			type: "partID"}
};

timeline.push(partID);

// JUMPS
// JUMPS
// JUMPS
// JUMPS
// JUMPS
// JUMPS
// JUMPS
// JUMPS
// JUMPS
// JUMPS
// JUMPS
// JUMPS
// JUMPS
// JUMPS
// JUMPS
// JUMPS
// JUMPS
// JUMPS

// jumpsStock2 = [
// "monkey", "lion", "elephant", "giraffe", "panda",
// "tiger", "bear", "bird", "dog", "cat", "fish",
// "horse", "snake", "cow", "mouse", "rat", "deer",
// "fox", "rabbit", "sloth"
// ];

var jumps1Instr = {
	type: 'html-button-response',
	stimulus: `There is this special machine called a ploosner. What makes it special is that when the<br>`+
    `ploosner is near a certain animal, the ploosner lights up! However, we're not sure what animal makes it light up.<br>`+
    `<b>We need your help today coming up with ideas for what animal may make the machine activate and light up.</b><br><br>`,
	choices: ["Continue"],
	data: {type: "jumps1Instr",
            exp: 'jumps'}
};

timeline.push(jumps1Instr);

var jumpsStock = [
"bunny", "cat", "dog", "bird",
"dolphin", "turtle", "fish",
"cow", "elephant", "zebra", "giraffe"
];

timeline.push({
  type: 'survey-text',
  questions: [
    {prompt: `What animal do you think made the machine light up?`, name: 'value', rows: 1, columns: 10, required: true}
  ],
  data: {
			trialType: `jumps1response`,
            type: `jumps1response1`,
            exp: 'jumps'}
});

for (i=0; i<4; i++) {
    timeline.push({
  type: 'survey-text',
  questions: [
    {prompt: `Okay, now you get to make another guess! What animal do you think made the machine light up?`, name: 'value', rows: 1, columns: 10, required: true}
  ],
  data: {
			trialType: `jumps1response`,
            type: `jumps1response${i+2}`,
            exp: 'jumps'}
})
}

var jumps1sortInstr =  {
	type: 'html-button-response',
	stimulus: `For this next part, we are going to look at the plans for a new zoo that's under construction.<br>`+
    `There are a number of animals the zoo knows they will have, but they haven't planned the layout<br>`+
    `for the exhibits yet. This is where you come in! <b><br><br>We want you to help them by arranging the layout on<br>`+
    `the next page in a way such that the animals that are the most similar are close together and the animals<br>`+
    `that are really different are farther apart</b>.<br><br>`+
    `When you're ready, click continue to begin.<br><br>`,
	choices: ["Continue"],
	data: {type: "jumps1sortInstr",
            exp: 'jumps'}
};

timeline.push(jumps1sortInstr);

// var jumpsResponses = {
//   type: 'survey-html-form',
//   preamble: '<p> Tell us a bit about yourself. Who are you? Think of 5 labels that describe yourself.</p>',
//   html: '<p> <input name="first" type="text" /><br> <input name="second" type="text" /><br>'+ 
//   '<input name="third" type="text" /><br> <input name="fourth" type="text" /><br>'+
//   '<input name="fifth" type="text" /><br>',
//   required: true,
//   dataAsArray: true,
//   data: {type: "jumpsResponses1"}
// };

var jumpsSorting = {
  type: 'free-sort',
  stimuli: function () {
    // var surveyResponses = jsPsych.data.get().filter({trial_type: 'survey-html-form'}).select('responses').values
    // var parsedSurveyResponses = JSON.parse(surveyResponses)

    var sorting_stimuli = [
    //   parsedSurveyResponses[0].value,
    //   parsedSurveyResponses[1].value,
    //   parsedSurveyResponses[2].value,
    //   parsedSurveyResponses[3].value,
    //   parsedSurveyResponses[4].value
    JSON.parse(jsPsych.data.get().filter({type: 'jumps1response1'}).select('responses').values).value,
    JSON.parse(jsPsych.data.get().filter({type: 'jumps1response2'}).select('responses').values).value,
    JSON.parse(jsPsych.data.get().filter({type: 'jumps1response3'}).select('responses').values).value,
    JSON.parse(jsPsych.data.get().filter({type: 'jumps1response4'}).select('responses').values).value,
    JSON.parse(jsPsych.data.get().filter({type: 'jumps1response5'}).select('responses').values).value

    ]

    for (i=0; i<7; i++) {
      sorting_stimuli.push(jsPsych.randomization.sampleWithoutReplacement($(jumpsStock).not(sorting_stimuli).get(), 1)[0])
    };

    return sorting_stimuli
  },
  prompt: "<p>Click and drag the animals below to sort them such that <b>similar animals are close together</b>.</p>",
  stim_starts_inside: false,
  column_spread_factor: 0.75,
  sort_area_shape: "square",
  data: {type: "jumpsSort",
        exp: "jumps"}
};

timeline.push(jumpsSorting);

// Demographics:

// var demographics = {
//   type: 'survey-multi-choice',
//   questions: [
//     {prompt: "<strong>Are you colorblind?</strong>", options: ["Yes, I am colorblind.","No, I am not colorblind"], values: ["Colorblind", "Not-Colorblind"], required: true, horizontal: false, name: 'Demo_Colorblind'}, 
//     {prompt: "<strong>What gender do you identify as?</strong>", options: ["Male", "Female", "Additional gender category/identity not listed", "Prefer not to answer"], values: ["Male", "Female", "Other", "No-Answer"], required: true, horizontal: false, name: 'Demo_Gender'},
//     {prompt: "<strong>What is your race/ethnicity?</strong>", options: ["Native American or Alaska Native", "Asian", "Pacific Islander", "Black or African American", "White", "Multi-racial / Multi-ethnic", "Other"], values: ["Native", "Asian", "Pacific-Islander", "Black", "White", "Multi", "Other"], required: true, horizontal: false, name: 'Demo_Race'},
//     {prompt: "<strong>Do you identify as Hispanic or Latino/a?</strong>", options: ["Yes, I identify as either Hispanic or Latino/a","No, I do not identify as either Hispanic or Latino/a"], values: ["Hispanic", "Not-Hispanic"], required: true, horizontal: false, name: 'Demo_Hispanic'}
//   ],
//   data: {
// 			type: "demographics"}
// };

// timeline.push(demographics);

// var demographics2 = {
//   type: 'survey-text',
//   questions: [
//     {prompt: "What is your current age?", name: 'Age', rows: 1, columns: 2, required: true},
//     {prompt: "In your own words, please tell us about what you have seen, and what you had to do, in this study so far:", name: 'ParticipationSummary', rows: 10, columns: 70, required: true}, 
//     {prompt: "If you had to guess, what do you think this study was about?", name: 'MotivationGuess', rows: 10, columns: 70, required: true}, 
//     {prompt: "During your participation, did you encounter any issues or technical difficulties?", name: 'TechnicalIssues', rows: 10, columns: 70, required: true}
//   ],
//   data: {
// 			type: "demographics2"}
// };

// timeline.push(demographics2);

jsPsych.data.addProperties({userAgent: navigator.userAgent,
	startTime: startTime,
// 	randCode: randCode
});

getPartID = function() {
  return JSON.parse(jsPsych.data.get().filter({type: 'partID'}).select('responses').values).partID
};

jsPsych.init({
      timeline: timeline,
      // preload_images: preloadImages,
	  show_progress_bar: true,
      on_finish: function () {
			var endTime = new Date();
			jsPsych.data.addProperties({endTime: endTime,
        partID: JSON.parse(jsPsych.data.get().filter({type: 'partID'}).select('responses').values).partID,
						   partID2: jsPsych.data.getURLVariable('ID')});
            // jsPsych.data.displayData();
			 SaveData(jsPsych.data.get().csv()); // .json()?
    }
    });

    function SaveData(curData) {
  var dataToServer = {
    'id': getPartID(),
    'experimenter': 'Ethan',
    'experimentName': 'Jumps_meditation_v1',
    'curData': curData
  }; 

  $.post("https://bradylab.ucsd.edu/turk/save.php",
    dataToServer,
    function(data) { 
			var newDoc = document.open("text/html", "replace");
			// newDoc.write("All done, thanks! To submit the HIT, paste this code into Turk: " + randCode);
            newDoc.write("Your responses have been recorded. This part of the study is now complete.<br>" +
			"You may now return to the previous page and start the next part.");
			newDoc.close();
    }
  ).fail(function(data) { 
			var newDoc = document.open("text/html", "replace");
			// newDoc.write("All done, thanks! To submit the HIT, paste this code into Turk: " + randCode);
            newDoc.write("Your responses have been recorded. This part of the study is now complete.<br>" +
			"You may now return to the previous page and start the next part.");
			newDoc.close();
	});  


  // $.post("http://localhost:8000/save.php",
  //   dataToServer,
  //   FunctionWhenDoneSaving
  // ).fail(FunctionWhenDoneSaving);
};

function FunctionWhenDoneSaving() {
        // var urlToRedirect = "https://ucsd.sona-systems.com/webstudy_credit.aspx?experiment_id=2079&credit_token=82002d4286dc4451a327871aa536edab&survey_code=" +
        // jsPsych.data.getURLVariable('survey_code');
    //    window.location.href = urlToRedirect;
      };

    </script>
  </body>
</html>
